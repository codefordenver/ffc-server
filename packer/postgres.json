{
  "variables": {
    "digitalocean_token": "{{env `DIGITALOCEAN_TOKEN`}}",
    "postgres_user": "{{env `POSTGRES_USER`}}",
    "postgres_password": "{{env `POSTGRES_PASSWORD`}}",
    "postgres_env": "{{env `POSTGRES_ENV`}}"
  },
  "builders": [{
    "type": "digitalocean",
    "api_token": "{{user `digitalocean_token`}}",
    "image": "ubuntu-15-04-x64",
    "region": "nyc3",
    "size": "512mb",
    "droplet_name": "atlas.postgres.ffc",
    "private_networking": true,
    "snapshot_name": "postgres.ffc {{timestamp}}"
  }],
  "push": {
  	"name": "codefordenver/freshfoodconnect-postgres"
  },
  "provisioners": [{
    "type": "shell",
    "environment_vars": [
      "POSTGRES_USER={{user `postgres_user`}}",
      "POSTGRES_PASSWORD={{user `postgres_password`}}",
      "POSTGRES_ENV={{user `postgres_env`}}"
    ],
    "inline": [
      "sudo mkdir /ops",
      "sudo chmod a+w /ops",
      "sudo echo 'export POSTGRES_USER='$POSTGRES_USER >> /etc/profile.d/envvars.sh",
      "sudo echo 'export POSTGRES_PASSWORD='$POSTGRES_PASSWORD >> /etc/profile.d/envvars.sh",
      "sudo echo 'export POSTGRES_ENV='$POSTGRES_ENV >> /etc/profile.d/envvars.sh"
    ]
  },
  {
    "type": "file",
    "source": ".",
    "destination": "/ops"
  },
  {
    "type": "shell",
    "script": "scripts/base.sh"
  },
  {
    "type": "shell",
    "script": "scripts/postgres.sh"
  }],
  "post-processors": [{
  	"type": "atlas",
  	"artifact": "codefordenver/freshfoodconnect-postgres",
  	"artifact_type": "digitalocean.image",
  	"metadata": {
  		"created_at": "{{timestamp}}",
  		"version": "{{user `version`}}"
  	}
  }]
}
